
version: '3.3'
services:
  ghost:
    image: ghost:5-alpine
    environment:
      database__client: mysql
      database__connection__database: ghostdb
      database__connection__host: db
      database__connection__password: ${ghostpass}
      database__connection__user: mysqluserx
      url: http://blog
    ports:
     - 2368:2368
    volumes:
     - ${config}/ghost:/var/lib/ghost/content
    networks:
     - traefik-public
    logging:
      driver: json-file
    deploy:
      replicas: 1
      labels:
        - 'traefik.enable=true'
        - 'traefik.http.routers.blog.rule=Host(`blog`)'
        - 'traefik.http.services.blog.loadbalancer.server.port=2368'
        - 'traefik.http.routers.blog.entrypoints=web'
        - 'homepage.group=Servarr'
        - 'homepage.name=ghost'
        - 'homepage.icon=ghost.png'
        - 'homepage.href=http://blog/'
        - 'homepage.description=blog'
  db:
    image: mysql:8.0
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${ghostpass}
    volumes:
      - ${config}/ghost/db:/var/lib/mysql
networks:
  traefik-public:
    external: true
