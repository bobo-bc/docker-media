version: "3.4"
services:
  ghost:
    image: ghost:5
    environment:
      url: http://blog
      database__client: mysql
      database__connection__host: mysqldbhost
      database__connection__user: root
      database__connection__password: ${ghostpass}
      database__connection__database: ghost
    volumes:
      - ${config}/ghost:/var/lib/ghost/content
    networks:
      - traefik-public
      - default
    deploy:
      labels:
        - traefik.enable=true
        - traefik.docker.network=traefik-public
        - 'traefik.http.routers.blog.rule=Host(`blog`)'
        - 'traefik.http.services.blog.loadbalancer.server.port=2368'
        - 'traefik.http.routers.blog.entrypoints=web'
        - 'homepage.group=Servarr'
        - 'homepage.name=ghost'
        - 'homepage.icon=ghost.png'
        - 'homepage.href=http://blog/'
        - 'homepage.description=blog'

  db:
    image: mariadb
    restart: always
    networks:
      - default
    volumes:
      - $config}/ghost/db:/var/lib/mysql
    environment:
      MARIADB_ROOT_PASSWORD:: ${ghostpass}
    deploy:
      replicas: 1
volumes:
  content:

networks:
  traefik-public:
    external: true
  default:
    external: false

